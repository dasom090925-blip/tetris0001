<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ÏôÑÏÑ±Ìòï ÌÖåÌä∏Î¶¨Ïä§</title>
    <style>
        body {
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh; margin: 0; background-color: #222;
            color: white; font-family: sans-serif; user-select: none; touch-action: manipulation;
        }
        #game-container { display: flex; flex-direction: column; align-items: center; background: #333; padding: 20px; border-radius: 15px; }
        #score-display { font-size: 24px; margin-bottom: 10px; color: #2ecc71; }
        #grid {
            width: 200px; height: 400px; display: grid;
            grid-template-columns: repeat(10, 1fr); grid-template-rows: repeat(20, 1fr);
            border: 4px solid #555; background-color: #000;
        }
        .square { width: 20px; height: 20px; box-sizing: border-box; border: 0.1px solid #111; }
        .tetromino { background-color: #3498db; border: 2px solid #fff; }
        .taken { background-color: #555; border: 1px solid #222; }
        #controls { display: grid; grid-template-areas: ". up ." "left down right"; gap: 10px; margin-top: 20px; }
        .btn {
            padding: 15px; font-size: 20px; cursor: pointer; background-color: #444;
            color: white; border: none; border-radius: 10px; min-width: 65px; min-height: 65px;
        }
        .btn:active { transform: scale(0.95); background-color: #666; }
        #start-btn { margin-top: 20px; width: 100%; height: 50px; background-color: #27ae60; font-weight: bold; border-radius: 10px; border: none; color: white; cursor: pointer; }
    </style>
</head>
<body>

    <div id="game-container">
        <div id="score-display">Score: <span id="score">0</span></div>
        <div id="grid"></div>
        <div id="controls">
            <button class="btn" style="grid-area: up;" id="rotate-btn">üîÑ</button>
            <button class="btn" style="grid-area: left;" id="left-btn">‚¨ÖÔ∏è</button>
            <button class="btn" style="grid-area: down;" id="down-btn">‚¨áÔ∏è</button>
            <button class="btn" style="grid-area: right;" id="right-btn">‚û°Ô∏è</button>
        </div>
        <button id="start-btn">Í≤åÏûÑ ÏãúÏûë / ÏùºÏãúÏ†ïÏßÄ</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const grid = document.querySelector('#grid');
            const scoreDisplay = document.querySelector('#score');
            const startBtn = document.querySelector('#start-btn');
            const width = 10;
            let timerId;
            let score = 0;

            // Í∑∏Î¶¨Îìú ÏÉùÏÑ±
            for (let i = 0; i < 200; i++) {
                const square = document.createElement('div');
                square.classList.add('square');
                grid.appendChild(square);
            }
            for (let i = 0; i < 10; i++) {
                const square = document.createElement('div');
                square.classList.add('square', 'taken');
                square.style.display = 'none';
                grid.appendChild(square);
            }

            let squares = Array.from(document.querySelectorAll('.square'));

            // --- ÏàòÏ†ïÎêú ÌÖåÌä∏Î¶¨Ïä§ Î∏îÎ°ù Îç∞Ïù¥ÌÑ∞ (Ï†ïÌôïÌïú ÌöåÏ†Ñ Ï¢åÌëú) ---
            const lTetromino = [
                [1, width+1, width*2+1, 2],
                [width, width+1, width+2, width*2+2],
                [1, width+1, width*2+1, width*2],
                [width, width*2, width*2+1, width*2+2]
            ];
            const zTetromino = [
                [width+1, width+2, width*2, width*2+1],
                [0, width, width+1, width*2+1],
                [width+1, width+2, width*2, width*2+1],
                [0, width, width+1, width*2+1]
            ];
            const tTetromino = [
                [1, width, width+1, width+2],
                [1, width+1, width+2, width*2+1],
                [width, width+1, width+2, width*2+1],
                [1, width, width+1, width*2+1]
            ];
            const oTetromino = [
                [0, 1, width, width+1],
                [0, 1, width, width+1],
                [0, 1, width, width+1],
                [0, 1, width, width+1]
            ];
            const iTetromino = [
                [1, width+1, width*2+1, width*3+1],
                [width, width+1, width+2, width+3],
                [1, width+1, width*2+1, width*3+1],
                [width, width+1, width+2, width+3]
            ];

            const theTetrominoes = [lTetromino, zTetromino, tTetromino, oTetromino, iTetromino];
            let random = Math.floor(Math.random() * theTetrominoes.length);
            let currentRotation = 0;
            let current = theTetrominoes[random][currentRotation];
            let currentPosition = 4;

            function draw() {
                current.forEach(index => squares[currentPosition + index].classList.add('tetromino'));
            }
            function undraw() {
                current.forEach(index => squares[currentPosition + index].classList.remove('tetromino'));
            }

            function moveDown() {
                if(!timerId) return;
                undraw();
                currentPosition += width;
                draw();
                freeze();
            }

            function freeze() {
                if(current.some(index => squares[currentPosition + index + width].classList.contains('taken'))) {
                    current.forEach(index => squares[currentPosition + index].classList.add('taken'));
                    random = Math.floor(Math.random() * theTetrominoes.length);
                    currentRotation = 0;
                    current = theTetrominoes[random][currentRotation];
                    currentPosition = 4;
                    addScore();
                    draw();
                    gameOver();
                }
            }

            function moveLeft() {
                undraw();
                const isAtLeftEdge = current.some(index => (currentPosition + index) % width === 0);
                if(!isAtLeftEdge) currentPosition -= 1;
                if(current.some(index => squares[currentPosition + index].classList.contains('taken'))) currentPosition += 1;
                draw();
            }

            function moveRight() {
                undraw();
                const isAtRightEdge = current.some(index => (currentPosition + index) % width === width - 1);
                if(!isAtRightEdge) currentPosition += 1;
                if(current.some(index => squares[currentPosition + index].classList.contains('taken'))) currentPosition -= 1;
                draw();
            }

            // --- ÏàòÏ†ïÎêú ÌöåÏ†Ñ Î°úÏßÅ (Î≤Ω Ï∂©Îèå Í≤ÄÏÇ¨ Í∞ïÌôî) ---
            function rotate() {
                undraw();
                const oldRotation = currentRotation;
                currentRotation = (currentRotation + 1) % current.length;
                const nextShape = theTetrominoes[random][currentRotation];

                // ÌöåÏ†Ñ Ïãú Î≤ΩÏùÑ ÎÑòÏñ¥Í∞ÄÎäîÏßÄ Ï≤¥ÌÅ¨
                const isAtRightEdge = nextShape.some(index => (currentPosition + index) % width === width - 1);
                const isAtLeftEdge = nextShape.some(index => (currentPosition + index) % width === 0);

                // ÎßåÏïΩ ÌöåÏ†ÑÌñàÎäîÎç∞ ÏñëÏ™Ω Î≤ΩÏùÑ ÎèôÏãúÏóê Í±¥ÎìúÎ¶∞Îã§Î©¥ (ÎπÑÏ†ïÏÉÅ ÌöåÏ†Ñ) ÏõêÎûòÎåÄÎ°ú Î≥µÍµ¨
                if (isAtRightEdge && isAtLeftEdge) {
                    currentRotation = oldRotation;
                } else {
                    current = nextShape;
                }
                
                // ÌöåÏ†Ñ ÌõÑ Í∏∞Ï°¥ Î∏îÎ°ùÍ≥º Í≤πÏπòÎ©¥ Ï∑®ÏÜå
                if(current.some(index => squares[currentPosition + index].classList.contains('taken'))) {
                    currentRotation = oldRotation;
                    current = theTetrominoes[random][currentRotation];
                }
                draw();
            }

            function addScore() {
                for (let i = 0; i < 199; i += width) {
                    const row = [i, i+1, i+2, i+3, i+4, i+5, i+6, i+7, i+8, i+9];
                    if(row.every(index => squares[index].classList.contains('taken'))) {
                        score += 10;
                        scoreDisplay.innerHTML = score;
                        row.forEach(index => squares[index].classList.remove('taken', 'tetromino'));
                        const squaresRemoved = squares.splice(i, width);
                        squares = squaresRemoved.concat(squares);
                        squares.forEach(cell => grid.appendChild(cell));
                    }
                }
            }

            function gameOver() {
                if(current.some(index => squares[currentPosition + index].classList.contains('taken'))) {
                    clearInterval(timerId);
                    timerId = null;
                    if(confirm("Í≤åÏûÑ Ïò§Î≤Ñ! Îã§Ïãú ÏãúÏûëÌïòÏãúÍ≤†ÏäµÎãàÍπå?")) resetGame();
                }
            }

            function resetGame() {
                squares.forEach(square => square.classList.remove('tetromino', 'taken'));
                for(let i = 200; i < 210; i++) squares[i].classList.add('taken');
                score = 0; scoreDisplay.innerHTML = score;
                currentPosition = 4;
                random = Math.floor(Math.random() * theTetrominoes.length);
                current = theTetrominoes[random][0];
                draw();
                timerId = setInterval(moveDown, 1000);
            }

            startBtn.addEventListener('click', () => {
                if(timerId) { clearInterval(timerId); timerId = null; } 
                else { draw(); timerId = setInterval(moveDown, 1000); }
            });

            document.getElementById('rotate-btn').addEventListener('click', rotate);
            document.getElementById('left-btn').addEventListener('click', moveLeft);
            document.getElementById('right-btn').addEventListener('click', moveRight);
            document.getElementById('down-btn').addEventListener('click', moveDown);
        });
    </script>
</body>
</html>
