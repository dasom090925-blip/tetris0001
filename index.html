<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ëª¨ë°”ì¼ í…ŒíŠ¸ë¦¬ìŠ¤ (ì¬ì‹œì‘ ê¸°ëŠ¥ í¬í•¨)</title>
    <style>
        /* ìŠ¤íƒ€ì¼ ì„¤ì • */
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #333;
            color: white;
            font-family: 'Arial', sans-serif;
            user-select: none;
            touch-action: manipulation;
        }

        #game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: #222;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        #score-display {
            font-size: 24px;
            margin-bottom: 10px;
            color: #2ecc71;
        }

        #grid {
            width: 200px;
            height: 400px;
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            grid-template-rows: repeat(20, 1fr);
            border: 4px solid #444;
            background-color: #000;
        }

        .square {
            width: 20px;
            height: 20px;
            box-sizing: border-box;
            border: 0.1px solid #111;
        }

        /* ë¸”ë¡ ìƒ‰ìƒ */
        .tetromino { background-color: #3498db; border: 2px solid #fff; }
        .taken { background-color: #7f8c8d; border: 1px solid #333; }

        /* ì»¨íŠ¸ë¡¤ ë²„íŠ¼ */
        #controls {
            display: grid;
            grid-template-areas: 
                ". rotate ."
                "left down right";
            gap: 12px;
            margin-top: 20px;
        }

        #rotate-btn { grid-area: rotate; background-color: #e67e22; }
        #left-btn { grid-area: left; }
        #right-btn { grid-area: right; }
        #down-btn { grid-area: down; }

        .btn {
            padding: 15px;
            font-size: 20px;
            cursor: pointer;
            background-color: #555;
            color: white;
            border: none;
            border-radius: 10px;
            min-width: 70px;
            min-height: 70px;
            box-shadow: 0 4px #333;
        }

        .btn:active {
            box-shadow: 0 0 #333;
            transform: translateY(4px);
        }

        #start-btn {
            margin-top: 20px;
            width: 100%;
            height: 50px;
            background-color: #2ecc71;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div id="game-container">
        <div id="score-display">Score: <span id="score">0</span></div>
        <div id="grid"></div>
        
        <div id="controls">
            <button class="btn" id="rotate-btn">ğŸ”„</button>
            <button class="btn" id="left-btn">â¬…ï¸</button>
            <button class="btn" id="down-btn">â¬‡ï¸</button>
            <button class="btn" id="right-btn">â¡ï¸</button>
        </div>
        <button class="btn" id="start-btn">ê²Œì„ ì‹œì‘ / ì¼ì‹œì •ì§€</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const grid = document.querySelector('#grid');
            const scoreDisplay = document.querySelector('#score');
            const startBtn = document.querySelector('#start-btn');
            const width = 10;
            let timerId;
            let score = 0;

            // 1. ê·¸ë¦¬ë“œ ìƒì„±
            for (let i = 0; i < 200; i++) {
                const square = document.createElement('div');
                square.classList.add('square');
                grid.appendChild(square);
            }
            // ë°”ë‹¥ ì¶©ëŒ ê°ì§€ìš© (ë³´ì´ì§€ ì•ŠìŒ)
            for (let i = 0; i < 10; i++) {
                const square = document.createElement('div');
                square.classList.add('square', 'taken');
                square.style.display = 'none';
                grid.appendChild(square);
            }

            let squares = Array.from(document.querySelectorAll('.square'));

            // 2. í…ŒíŠ¸ë¦¬ìŠ¤ ë¸”ë¡ ëª¨ì–‘
            const lTetromino = [
                [1, width + 1, width * 2 + 1, 2],
                [width, width + 1, width + 2, width * 2 + 2],
                [1, width + 1, width * 2 + 1, width * 2],
                [width, width * 2, width * 2 + 1, width * 2 + 2]
            ];
            const zTetromino = [
                [0, width, width + 1, width * 2 + 1],
                [width + 1, width + 2, width, width + 1],
                [0, width, width + 1, width * 2 + 1],
                [width + 1, width + 2, width, width + 1]
            ];
            const tTetromino = [
                [1, width, width + 1, width + 2],
                [1, width + 1, width + 2, width * 2 + 1],
                [width, width + 1, width + 2, width * 2 + 1],
                [1, width, width + 1, width * 2 + 1]
            ];
            const oTetromino = [
                [0, 1, width, width + 1],
                [0, 1, width, width + 1],
                [0, 1, width, width + 1],
                [0, 1, width, width + 1]
            ];
            const iTetromino = [
                [1, width + 1, width * 2 + 1, width * 3 + 1],
                [width, width + 1, width + 2, width + 3],
                [1, width + 1, width * 2 + 1, width * 3 + 1],
                [width, width + 1, width + 2, width + 3]
            ];

            const theTetrominoes = [lTetromino, zTetromino, tTetromino, oTetromino, iTetromino];

            let currentPosition = 4;
            let currentRotation = 0;
            let random = Math.floor(Math.random() * theTetrominoes.length);
            let current = theTetrominoes[random][currentRotation];

            function draw() {
                current.forEach(index => {
                    squares[currentPosition + index].classList.add('tetromino');
                });
            }

            function undraw() {
                current.forEach(index => {
                    squares[currentPosition + index].classList.remove('tetromino');
                });
            }

            // ì•„ë˜ë¡œ ì´ë™
            function moveDown() {
                if (timerId) {
                    undraw();
                    currentPosition += width;
                    draw();
                    freeze();
                }
            }

            // ê³ ì • í•¨ìˆ˜
            function freeze() {
                if (current.some(index => squares[currentPosition + index + width].classList.contains('taken'))) {
                    current.forEach(index => squares[currentPosition + index].classList.add('taken'));
                    
                    random = Math.floor(Math.random() * theTetrominoes.length);
                    current = theTetrominoes[random][0];
                    currentPosition = 4;
                    
                    addScore();
                    draw();
                    gameOver();
                }
            }

            // ì¢Œìš° ì´ë™
            function moveLeft() {
                undraw();
                const isAtLeftEdge = current.some(index => (currentPosition + index) % width === 0);
                if (!isAtLeftEdge) currentPosition -= 1;
                if (current.some(index => squares[currentPosition + index].classList.contains('taken'))) {
                    currentPosition += 1;
                }
                draw();
            }

            function moveRight() {
                undraw();
                const isAtRightEdge = current.some(index => (currentPosition + index) % width === width - 1);
                if (!isAtRightEdge) currentPosition += 1;
                if (current.some(index => squares[currentPosition + index].classList.contains('taken'))) {
                    currentPosition -= 1;
                }
                draw();
            }

            // íšŒì „
            function rotate() {
                undraw();
                currentRotation++;
                if (currentRotation === current.length) currentRotation = 0;
                current = theTetrominoes[random][currentRotation];
                
                // ë²½ ëš«ê¸° ë°©ì§€
                const isAtRightEdge = current.some(index => (currentPosition + index) % width === width - 1);
                const isAtLeftEdge = current.some(index => (currentPosition + index) % width === 0);
                if (isAtRightEdge && isAtLeftEdge) { // ë„ˆë¬´ ê¸´ ë¸”ë¡ ì˜ˆì™¸ì²˜ë¦¬
                    currentRotation--;
                    current = theTetrominoes[random][currentRotation];
                }
                draw();
            }

            // ì ìˆ˜ ì¶”ê°€ ë° ì¤„ ì‚­ì œ
            function addScore() {
                for (let i = 0; i < 199; i += width) {
                    const row = [i, i+1, i+2, i+3, i+4, i+5, i+6, i+7, i+8, i+9];
                    if (row.every(index => squares[index].classList.contains('taken'))) {
                        score += 10;
                        scoreDisplay.innerHTML = score;
                        row.forEach(index => {
                            squares[index].classList.remove('taken', 'tetromino');
                        });
                        const squaresRemoved = squares.splice(i, width);
                        squares = squaresRemoved.concat(squares);
                        squares.forEach(cell => grid.appendChild(cell));
                    }
                }
            }

            // ê²Œì„ ì˜¤ë²„ ê¸°ëŠ¥
            function gameOver() {
                if (current.some(index => squares[currentPosition + index].classList.contains('taken'))) {
                    clearInterval(timerId);
                    timerId = null;
                    setTimeout(() => {
                        if (confirm("ê²Œì„ ì˜¤ë²„! ì ìˆ˜: " + score + "\në‹¤ì‹œ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                            resetGame();
                        }
                    }, 100);
                }
            }

            // ë‹¤ì‹œ ì‹œì‘(ë¦¬ì…‹) í•¨ìˆ˜
            function resetGame() {
                squares.forEach(square => {
                    square.classList.remove('tetromino', 'taken');
                });
                // ë°”ë‹¥ ì˜ì—­ ì¬ì„¤ì •
                for (let i = 200; i < 210; i++) {
                    squares[i].classList.add('taken');
                }
                score = 0;
                scoreDisplay.innerHTML = score;
                currentPosition = 4;
                random = Math.floor(Math.random() * theTetrominoes.length);
                current = theTetrominoes[random][0];
                draw();
                timerId = setInterval(moveDown, 1000);
            }

            // ë²„íŠ¼ ì´ë²¤íŠ¸
            startBtn.addEventListener('click', () => {
                if (timerId) {
                    clearInterval(timerId);
                    timerId = null;
                } else {
                    draw();
                    timerId = setInterval(moveDown, 1000);
                }
            });

            document.getElementById('rotate-btn').addEventListener('click', rotate);
            document.getElementById('left-btn').addEventListener('click', moveLeft);
            document.getElementById('right-btn').addEventListener('click', moveRight);
            document.getElementById('down-btn').addEventListener('click', moveDown);

            // í‚¤ë³´ë“œ ì§€ì›
            document.addEventListener('keydown', (e) => {
                if (e.keyCode === 37) moveLeft();
                if (e.keyCode === 38) rotate();
                if (e.keyCode === 39) moveRight();
                if (e.keyCode === 40) moveDown();
            });
        });
    </script>
</body>
</html>
