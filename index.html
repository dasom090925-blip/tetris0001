// 7. 행 클리어 로직 (수정된 버전)
function checkRowForClear() {
    let linesCleared = 0;
    
    // Grid를 맨 위(0)부터가 아니라, 맨 아래(width * height - width)부터 확인합니다.
    for (let i = width * height - width; i >= 0; i -= width) {
        
        // 현재 검사 중인 행의 인덱스들
        const row = Array.from({ length: width }, (_, k) => i + k);
        
        // 현재 행이 모두 'taken' 클래스를 가졌는지 확인
        const isRowFull = row.every(index => squares[index].classList.contains('taken'));
        
        if (isRowFull) {
            linesCleared++;
            
            // 1. 해당 행의 모든 클래스와 스타일 제거 (화면에서 사라짐)
            row.forEach(index => {
                squares[index].classList.remove('taken', 'block');
                squares[index].style.backgroundColor = '';
            });
            
            // 2. 위의 모든 블록을 한 칸씩 아래로 내리는 작업
            // (i - 1)부터 맨 위(0)까지 역순으로 반복합니다.
            for (let j = i - 1; j >= 0; j--) {
                const squareBelow = squares[j + width]; // 바로 아래 칸
                const currentSquare = squares[j];       // 현재 칸
                
                // 현재 칸이 'taken' 상태면, 그 정보를 아래 칸으로 복사합니다.
                if (currentSquare.classList.contains('taken')) {
                    // 클래스/스타일 복사
                    squareBelow.classList.add('taken', 'block');
                    squareBelow.style.backgroundColor = currentSquare.style.backgroundColor;
                    
                    // 현재 칸 비우기 (위에서 아래로 이동했으므로)
                    currentSquare.classList.remove('taken', 'block');
                    currentSquare.style.backgroundColor = '';
                }
            }
            
            // 행을 클리어했으므로, 다시 현재 i 위치부터 검사하도록 i 값을 조정하지 않습니다.
            // (이전에 클리어한 행 때문에 새로운 행이 이 위치로 내려왔을 수 있기 때문)
            i += width; 
        }
    }
    
    // 점수 업데이트
    if (linesCleared > 0) {
        // 클리어한 줄 수에 따라 점수 부여 (테트리스 방식)
        score += linesCleared === 4 ? 800 : linesCleared * 100;
        scoreDisplay.textContent = `Score: ${score}`;
    }
}
