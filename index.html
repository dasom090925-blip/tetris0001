<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ëª¨ë°”ì¼ í†µí•© í…ŒíŠ¸ë¦¬ìŠ¤</title>
    
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #333;
            color: white;
            font-family: Arial, sans-serif;
            user-select: none; /* ëª¨ë°”ì¼ì—ì„œ ë“œë˜ê·¸ ì„ íƒ ë°©ì§€ */
            padding: 20px 0;
        }

        #game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: #222;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
        }

        #grid {
            width: 200px; /* 10ì¹¸ * 20px */
            height: 400px; /* 20ì¹¸ * 20px */
            display: grid;
            grid-template-columns: repeat(10, 1fr); 
            border: 3px solid #ccc;
            background-color: #000;
        }

        /* ê° ë¸”ë¡/ì…€ ìŠ¤íƒ€ì¼ */
        .square {
            width: 100%;
            height: 100%;
            box-sizing: border-box;
            border: 1px solid #111;
        }

        .taken {
            border: none;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.5);
        }

        .hidden {
            display: none;
        }

        /* --- ëª¨ë°”ì¼ ì»¨íŠ¸ë¡¤ ìŠ¤íƒ€ì¼ --- */
        #controls {
            display: grid;
            grid-template-areas: 
                ". rotate ."
                "left down right";
            gap: 10px;
            margin-top: 20px;
            width: 300px;
        }

        #rotate-btn { grid-area: rotate; }
        #left-btn { grid-area: left; }
        #right-btn { grid-area: right; }
        #down-btn { grid-area: down; }

        #controls button, #start-btn {
            padding: 15px;
            font-size: 24px;
            cursor: pointer;
            background-color: #555;
            color: white;
            border: 1px solid #777;
            border-radius: 5px;
            min-width: 70px; 
            min-height: 70px;
            transition: background-color 0.1s;
        }
        
        #start-btn {
            margin-top: 15px;
            padding: 10px 20px;
            font-size: 18px;
            min-width: unset;
            min-height: unset;
        }

        #controls button:active, #start-btn:active {
            background-color: #777;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <h1>Tetris!</h1>
        <div id="score-display">Score: 0</div>
        
        <div id="grid"></div>
        
        <div id="controls">
            <button id="rotate-btn">ğŸ”„ Rotate</button>
            <button id="left-btn">â—€ï¸ Left</button>
            <button id="right-btn">â–¶ï¸ Right</button>
            <button id="down-btn">â¬‡ï¸ Soft Drop</button>
        </div>
        
        <button id="start-btn">Start Game</button>
        <div id="game-over-message" class="hidden" style="color: red; font-size: 24px; margin-top: 10px;">
            GAME OVER!
        </div>
    </div>

    <script>
        // ê²Œì„ ì„¤ì •
        const width = 10;
        const height = 20;
        const grid = document.getElementById('grid');
        const squares = [];
        let currentPosition = 4;
        let score = 0;
        let timerId = null;
        const scoreDisplay = document.getElementById('score-display');
        const startBtn = document.getElementById('start-btn');
        const gameOverMsg = document.getElementById('game-over-message');

        // 1. Grid ìƒì„±
        function createGrid() {
            for (let i = 0; i < width * height; i++) {
                const square = document.createElement('div');
                square.classList.add('square');
                grid.appendChild(square);
                squares.push(square);
            }
        }
        createGrid();

        // 2. í…ŒíŠ¸ë¡œë¯¸ë…¸ ëª¨ì–‘ ì •ì˜
        // [ëª¨ì–‘ 0], [ëª¨ì–‘ 1], [ëª¨ì–‘ 2], [ëª¨ì–‘ 3]
        const lBlock = [
            [1, width + 1, width * 2 + 1, 2],
            [width, width + 1, width + 2, width * 2 + 2],
            [1, width + 1, width * 2 + 1, width * 2],
            [width, width * 2, width * 2 + 1, width * 2 + 2]
        ];

        const zBlock = [
            [width, width + 1, 2 * width + 1, 2 * width + 2],
            [1, width, width + 1, 2 * width],
            [width, width + 1, 2 * width + 1, 2 * width + 2],
            [1, width, width + 1, 2 * width]
        ];

        const tBlock = [
            [1, width, width + 1, width + 2],
            [1, width + 1, width * 2 + 1, width],
            [width, width + 1, width + 2, width * 2 + 1],
            [1, width + 1, width * 2 + 1, width * 2 + 2]
        ];
        
        const oBlock = [
            [0, 1, width, width + 1]
        ];

        const iBlock = [
            [1, width + 1, width * 2 + 1, width * 3 + 1],
            [width, width + 1, width + 2, width + 3],
            [1, width + 1, width * 2 + 1, width * 3 + 1],
            [width, width + 1, width + 2, width + 3]
        ];


        const theTetrominoes = [lBlock, zBlock, tBlock, oBlock, iBlock];
        const colors = ['orange', 'red', 'purple', 'yellow', 'cyan'];

        // í˜„ì¬ ë¸”ë¡ ì´ˆê¸°í™”
        let random = Math.floor(Math.random() * theTetrominoes.length);
        let nextRandom = Math.floor(Math.random() * theTetrominoes.length);
        let currentRotation = 0;
        let current = theTetrominoes[random][currentRotation];
        let currentColor = colors[random];

        // 3. ë¸”ë¡ ê·¸ë¦¬ê¸°
        function draw() {
            current.forEach(index => {
                squares[currentPosition + index].classList.add('block');
                squares[currentPosition + index].style.backgroundColor = currentColor;
            });
        }

        // 4. ë¸”ë¡ ì§€ìš°ê¸°
        function undraw() {
            current.forEach(index => {
                squares[currentPosition + index].classList.remove('block');
                squares[currentPosition + index].style.backgroundColor = '';
            });
        }
        
        function isAtBottom(index) {
            return index + width >= width * height;
        }

        // 5. ì•„ë˜ë¡œ ì´ë™ (ë©”ì¸ ê²Œì„ ë£¨í”„)
        function moveDown() {
            undraw();
            // ì¶©ëŒ ê°ì§€: ë‹¤ìŒ ìœ„ì¹˜ê°€ ë°”ë‹¥(grid.length)ì„ ë„˜ì–´ì„œê±°ë‚˜, ì´ë¯¸ 'taken' ë¸”ë¡ì´ ìˆëŠ” ê²½ìš°
            const isCollision = current.some(index => 
                isAtBottom(currentPosition + index) || 
                squares[currentPosition + index + width].classList.contains('taken')
            );
            
            if (!isCollision) {
                currentPosition += width;
            } else {
                freeze(); // ì¶©ëŒ ë°œìƒ: ë¸”ë¡ì„ ë©ˆì¶”ê³  ìƒˆë¡œìš´ ë¸”ë¡ ìƒì„±
            }
            draw();
        }

        // 6. ë¸”ë¡ ë©ˆì¶”ê¸° (Freeze) ë° ìƒˆ ë¸”ë¡ ìƒì„±
        function freeze() {
            // ëª¨ë“  ë¸”ë¡ì´ ë©ˆì·„ìŒì„ í‘œì‹œ
            current.forEach(index => squares[currentPosition + index].classList.add('taken'));
            
            checkRowForClear();
            
            // ìƒˆ ë¸”ë¡ ìƒì„± ì¤€ë¹„ (Next Random ì‚¬ìš©)
            random = nextRandom;
            nextRandom = Math.floor(Math.random() * theTetrominoes.length);
            currentRotation = 0;
            current = theTetrominoes[random][currentRotation];
            currentColor = colors[random];
            currentPosition = 4;
            
            // ê²Œì„ ì˜¤ë²„ í™•ì¸: ìƒˆë¡œìš´ ë¸”ë¡ì´ ì‹œì‘í•˜ìë§ˆì ê²¹ì¹˜ëŠ” ê²½ìš° (4ë²ˆì§¸ ì¤„ì— takenì´ ìˆìœ¼ë©´)
            if (current.some(index => squares[currentPosition + index].classList.contains('taken'))) {
                clearInterval(timerId);
                timerId = null;
                gameOverMsg.classList.remove('hidden');
                startBtn.textContent = 'Restart Game';
            }
            // draw()ëŠ” moveDownì—ì„œ ì²˜ë¦¬ë˜ê±°ë‚˜, freeze ì§í›„ draw()ë¥¼ í˜¸ì¶œí•´ì•¼ í•¨
        }

        // 7. í–‰ í´ë¦¬ì–´ ë¡œì§
        function checkRowForClear() {
            for (let i = 0; i < width * height; i += width) {
                const row = Array.from({ length: width }, (_, k) => i + k); // í˜„ì¬ í–‰ì˜ ì¸ë±ìŠ¤ ë°°ì—´
                
                const isRowFull = row.every(index => squares[index].classList.contains('taken'));
                
                if (isRowFull) {
                    score += 10;
                    scoreDisplay.textContent = `Score: ${score}`;
                    
                    // 1. í–‰ ì§€ìš°ê¸° ë° taken ì œê±°
                    row.forEach(index => {
                        squares[index].classList.remove('taken', 'block');
                        squares[index].style.backgroundColor = '';
                    });
                    
                    // 2. ìœ„ì˜ ëª¨ë“  ë¸”ë¡ì„ í•œ ì¹¸ì”© ì•„ë˜ë¡œ ë‚´ë¦¬ê¸°
                    const squaresRemoved = squares.splice(i, width); // ì œê±°ëœ í–‰ (10ê°œ)
                    squares.splice(0, 0, ...squaresRemoved); // ì œê±°ëœ í–‰ì„ ë§¨ ìœ„(0ë²ˆ ì¸ë±ìŠ¤)ì— ì¶”ê°€
                    
                    // 3. Grid ì—…ë°ì´íŠ¸ (DOM ìš”ì†Œ êµì²´)
                    squares.forEach(square => grid.appendChild(square));
                }
            }
        }

        // --- 8. ì´ë™ ë° íšŒì „ í•¨ìˆ˜ ---
        
        function moveLeft() {
            if (!timerId) return; // ê²Œì„ ì¼ì‹œì •ì§€ ìƒíƒœë©´ ì‘ë™ ì•ˆ í•¨
            undraw();
            const isAtLeftEdge = current.some(index => (currentPosition + index) % width === 0);
            if (!isAtLeftEdge) currentPosition -= 1;
            // ì´ë™ í›„ ë‹¤ë¥¸ ë¸”ë¡ì— ê²¹ì³ì¡ŒëŠ”ì§€ í™•ì¸ í›„ ê²¹ì³¤ë‹¤ë©´ ë‹¤ì‹œ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ë³µêµ¬
            if (current.some(index => squares[currentPosition + index].classList.contains('taken'))) {
                currentPosition += 1;
            }
            draw();
        }

        function moveRight() {
            if (!timerId) return;
            undraw();
            const isAtRightEdge = current.some(index => (currentPosition + index) % width === width - 1);
            if (!isAtRightEdge) currentPosition += 1;
            if (current.some(index => squares[currentPosition + index].classList.contains('taken'))) {
                currentPosition -= 1;
            }
            draw();
        }

        function rotate() {
            if (!timerId) return;
            undraw();
            
            const originalRotation = currentRotation;
            currentRotation = (currentRotation + 1) % theTetrominoes[random].length;
            current = theTetrominoes[random][currentRotation];

            // íšŒì „ í›„ ë²½ í†µê³¼ ì—¬ë¶€ ë° ì¶©ëŒ ì²´í¬ (ë‹¨ìˆœ êµ¬í˜„)
            const isRotatedIntoWall = current.some(index => 
                (currentPosition + index) % width === width - 1 && 
                (currentPosition + index + width) % width === 0
            );

            if (isRotatedIntoWall || current.some(index => squares[currentPosition + index].classList.contains('taken'))) {
                // íšŒì „ ì·¨ì†Œ
                currentRotation = originalRotation;
                current = theTetrominoes[random][currentRotation];
            }
            draw();
        }

        // 9. ëª¨ë°”ì¼ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²°
        document.getElementById('left-btn').addEventListener('click', moveLeft);
        document.getElementById('right-btn').addEventListener('click', moveRight);
        document.getElementById('down-btn').addEventListener('click', moveDown); // soft drop
        document.getElementById('rotate-btn').addEventListener('click', rotate);
        
        // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ (PC í…ŒìŠ¤íŠ¸ìš©)
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') moveLeft();
            else if (e.key === 'ArrowRight') moveRight();
            else if (e.key === 'ArrowDown') moveDown();
            else if (e.key === 'ArrowUp') rotate();
        });


        // 10. ê²Œì„ ì‹œì‘/ì¬ì‹œì‘
        function startGame() {
            if (timerId) {
                // ê²Œì„ ì¼ì‹œì •ì§€
                clearInterval(timerId);
                timerId = null;
                startBtn.textContent = 'Resume Game';
            } else {
                // ê²Œì„ ì‹œì‘ ë˜ëŠ” ì¬ê°œ
                if (gameOverMsg.classList.contains('hidden') === false) {
                    // Game Over ìƒíƒœì—ì„œ ì¬ì‹œì‘ ë¡œì§ (ì´ˆê¸°í™”)
                    squares.forEach(s => {
                       s.classList.remove('block', 'taken');
                       s.style.backgroundColor = '';
                    });
                    score = 0;
                    scoreDisplay.textContent = 'Score: 0';
                    gameOverMsg.classList.add('hidden');
                    
                    // ì´ˆê¸° ë¸”ë¡ ë‹¤ì‹œ ì„¤ì • (freeze()ì—ì„œ nextRandomì„ ì‚¬ìš©í–ˆê¸° ë•Œë¬¸ì— randomë„ ì´ˆê¸°í™” í•„ìš”)
                    random = Math.floor(Math.random() * theTetrominoes.length);
                    nextRandom = Math.floor(Math.random() * theTetrominoes.length);
                    current = theTetrominoes[random][currentRotation];
                    currentColor = colors[random];
                    currentPosition = 4;
                }

                draw();
                timerId = setInterval(moveDown, 1000); // 1ì´ˆë§ˆë‹¤ í•˜ê°• ì†ë„
                startBtn.textContent = 'Pause Game';
            }
        }
        
        startBtn.addEventListener('click', startGame);
    </script>
</body>
</html>
