<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ëª¨ë°”ì¼ í†µí•© í…ŒíŠ¸ë¦¬ìŠ¤</title>
    <style>
        /* CSS ìŠ¤íƒ€ì¼ë§ */
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #333;
            color: white;
            font-family: Arial, sans-serif;
            user-select: none;
            touch-action: manipulation; 
        }
        #game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: #222;
            padding: 15px;
            border-radius: 10px;
        }
        #grid {
            width: 200px;
            height: 400px;
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            grid-template-rows: repeat(20, 1fr);
            border: 3px solid #ccc;
            background-color: #000;
        }
        .square {
            width: 20px;
            height: 20px;
            box-sizing: border-box;
            border: 1px solid #111;
        }
        /* í…ŒíŠ¸ë¦¬ìŠ¤ ë¸”ë¡ ìƒ‰ìƒ */
        .tetromino { background-color: #ff0d72; border: 1px solid white; }
        .taken { background-color: #555; border: 1px solid #333; }

        #controls {
            display: grid;
            grid-template-areas: 
                ". rotate ."
                "left down right";
            gap: 10px;
            margin-top: 20px;
        }
        #rotate-btn { grid-area: rotate; }
        #left-btn { grid-area: left; }
        #right-btn { grid-area: right; }
        #down-btn { grid-area: down; }

        button {
            padding: 15px;
            font-size: 18px;
            cursor: pointer;
            background-color: #555;
            color: white;
            border: none;
            border-radius: 10px;
            min-width: 60px;
            min-height: 60px;
        }
        #start-btn {
            margin-top: 15px;
            width: 100%;
            background-color: #2ecc71;
        }
    </style>
</head>
<body>

    <div id="game-container">
        <h1>Tetris!</h1>
        <div id="score-display">Score: <span id="score">0</span></div>
        <div id="grid"></div>
        
        <div id="controls">
            <button id="rotate-btn">ğŸ”„</button>
            <button id="left-btn">â¬…ï¸</button>
            <button id="down-btn">â¬‡ï¸</button>
            <button id="right-btn">â¡ï¸</button>
        </div>
        <button id="start-btn">ê²Œì„ ì‹œì‘/ì •ì§€</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const grid = document.querySelector('#grid');
            const scoreDisplay = document.querySelector('#score');
            const startBtn = document.querySelector('#start-btn');
            const width = 10;
            let nextRandom = 0;
            let timerId;
            let score = 0;

            // 1. ê·¸ë¦¬ë“œ ìƒì„± (200ì¹¸ + ë°”ë‹¥ 10ì¹¸)
            for (let i = 0; i < 200; i++) {
                const square = document.createElement('div');
                square.classList.add('square');
                grid.appendChild(square);
            }
            // ë°”ë‹¥ ê°ì§€ìš© (ë³´ì´ì§€ ì•ŠìŒ)
            for (let i = 0; i < 10; i++) {
                const square = document.createElement('div');
                square.classList.add('taken', 'square');
                square.style.display = 'none';
                grid.appendChild(square);
            }

            let squares = Array.from(document.querySelectorAll('#grid div'));

            // 2. í…ŒíŠ¸ë¦¬ìŠ¤ ë¸”ë¡ ëª¨ì–‘ ì •ì˜
            const lTetromino = [
                [1, width + 1, width * 2 + 1, 2],
                [width, width + 1, width + 2, width * 2 + 2],
                [1, width + 1, width * 2 + 1, width * 2],
                [width, width * 2, width * 2 + 1, width * 2 + 2]
            ];
            const zTetromino = [
                [0, width, width + 1, width * 2 + 1],
                [width + 1, width + 2, width, width + 1],
                [0, width, width + 1, width * 2 + 1],
                [width + 1, width + 2, width, width + 1]
            ];
            const tTetromino = [
                [1, width, width + 1, width + 2],
                [1, width + 1, width + 2, width * 2 + 1],
                [width, width + 1, width + 2, width * 2 + 1],
                [1, width, width + 1, width * 2 + 1]
            ];
            const oTetromino = [
                [0, 1, width, width + 1],
                [0, 1, width, width + 1],
                [0, 1, width, width + 1],
                [0, 1, width, width + 1]
            ];
            const iTetromino = [
                [1, width + 1, width * 2 + 1, width * 3 + 1],
                [width, width + 1, width + 2, width + 3],
                [1, width + 1, width * 2 + 1, width * 3 + 1],
                [width, width + 1, width + 2, width + 3]
            ];

            const theTetrominoes = [lTetromino, zTetromino, tTetromino, oTetromino, iTetromino];

            let currentPosition = 4;
            let currentRotation = 0;
            let random = Math.floor(Math.random() * theTetrominoes.length);
            let current = theTetrominoes[random][currentRotation];

            // ê·¸ë¦¬ê¸° í•¨ìˆ˜
            function draw() {
                current.forEach(index => {
                    squares[currentPosition + index].classList.add('tetromino');
                });
            }

            // ì§€ìš°ê¸° í•¨ìˆ˜
            function undraw() {
                current.forEach(index => {
                    squares[currentPosition + index].classList.remove('tetromino');
                });
            }

            // ì•„ë˜ë¡œ ì´ë™
            function moveDown() {
                undraw();
                currentPosition += width;
                draw();
                freeze();
            }

            // ë°”ë‹¥ì— ë‹¿ì•˜ëŠ”ì§€ í™•ì¸
            function freeze() {
                if (current.some(index => squares[currentPosition + index + width].classList.contains('taken'))) {
                    current.forEach(index => squares[currentPosition + index].classList.add('taken'));
                    // ìƒˆ ë¸”ë¡ ìƒì„±
                    random = Math.floor(Math.random() * theTetrominoes.length);
                    current = theTetrominoes[random][0];
                    currentPosition = 4;
                    currentRotation = 0;
                    addScore();
                    draw();
                    gameOver();
                }
            }

            // ì¢Œìš° ì´ë™
            function moveLeft() {
                undraw();
                const isAtLeftEdge = current.some(index => (currentPosition + index) % width === 0);
                if (!isAtLeftEdge) currentPosition -= 1;
                if (current.some(index => squares[currentPosition + index].classList.contains('taken'))) {
                    currentPosition += 1;
                }
                draw();
            }

            function moveRight() {
                undraw();
                const isAtRightEdge = current.some(index => (currentPosition + index) % width === width - 1);
                if (!isAtRightEdge) currentPosition += 1;
                if (current.some(index => squares[currentPosition + index].classList.contains('taken'))) {
                    currentPosition -= 1;
                }
                draw();
            }

            // íšŒì „
            function rotate() {
                undraw();
                currentRotation++;
                if (currentRotation === current.length) currentRotation = 0;
                current = theTetrominoes[random][currentRotation];
                draw();
            }

            // í‚¤ë³´ë“œ ì»¨íŠ¸ë¡¤
            function control(e) {
                if (e.keyCode === 37) moveLeft();
                else if (e.keyCode === 38) rotate();
                else if (e.keyCode === 39) moveRight();
                else if (e.keyCode === 40) moveDown();
            }
            document.addEventListener('keyup', control);

            // ë²„íŠ¼ ì»¨íŠ¸ë¡¤
            document.getElementById('rotate-btn').addEventListener('click', rotate);
            document.getElementById('left-btn').addEventListener('click', moveLeft);
            document.getElementById('right-btn').addEventListener('click', moveRight);
            document.getElementById('down-btn').addEventListener('click', moveDown);

            // ì ìˆ˜ ë° ì¤„ ì‚­ì œ
            function add
